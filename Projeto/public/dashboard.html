<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/dashboards.css">
    <link rel="icon" type="image/x-icon" href="assets/imgs/Adobe Express - file.png">
    

    <title>Dashboard</title>
</head>

<body>
    <header class="header">
        <div class="logo">
            <img src="./assets/imgs/logo.png" alt="review.it">
        </div>
        <div class="logo2">
            <a href="index.html">dashboard</a>
        </div>
        <div class="containerHeader">
            <ul class="navbar">
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="musicas.html">Músicas</a></li>
                <li><a href="sobremim.html">Sobre</a></li>
                <li><a href="cadastro.html">Cadastrar</a></li>
                <li class="dropdown">
                    <a href="#" id="perfil-link">Perfil</a>
                    <ul class="dropdown-content">
                        <li><a href="perfil.html">Ver Perfil</a></li>
                        <li><a href="#" onclick="logout()">Logout</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </header>
    <div class="mainCard">
        <hr>
        <h1>Os mais críticos.</h1>
        <hr>
        <div class="graficos">
           
        </div>
    </div>
</body>
<script>

    reviewsUsuarios()

    function reviewsUsuarios(){
        console.log("entrei na function")
        fetch(`/usuarios/reviewsUsuarios`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then((resposta) => {
                if (resposta.ok) {
                    return resposta.json(); 
                } else if (resposta.status === 204) {
                    // Caso não haja álbuns
                    const container = document.querySelector(".graficos");
                    container.innerHTML = "<p>Erro!</p>";
                    return [];
                } else {
                    throw new Error("Erro na API.");
                }
            }).then((reviews) => {
                const container = document.querySelector(".graficos");
                container.innerHTML = ""; 
                if (reviews.length === 0) {
                    container.innerHTML = "<p>Nenhum usuário com reviews encontrados.</p>";
                    return;
                }
                reviews.forEach((usuario) => {
                   const usuarioCard = document.createElement("div");
                   usuarioCard.classList.add("usuario-card"); 

                   usuarioCard.innerHTML = `
                        <div class="nome-usuario"> 
                            <img src="assets/${usuario.imagem_perfil}">
                            <h1>${usuario.nome}</h1>
                            <p>Total de reviews: <br> <label class"numero">${usuario.total_reviews}</label></p>
                        </div>
`                           ;

                    container.appendChild(usuarioCard);
                });
            })
            .catch((erro) => {
                console.error("Erro ao carregar:", erro);
                const container = document.querySelector(".graficos");
                container.innerHTML = "<p>Erro ao carregar.</p>";
            });
}

</script>