<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./css/musicas.css" />
  <link rel="icon" type="image/x-icon" href="assets/imgs/Adobe Express - file.png">

  <title>Músicas</title>
</head>

<body>
  <header class="header">
    <div class="logo">
      <img src="./assets/imgs/logo.png" alt="review.it">
    </div>
    <div class="logo2">
      <a href="index.html">review.it</a>
    </div>
    <div class="container">
      <ul class="navbar">
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="musicas.html">Álbums</a></li>
        <li><a href="sobremim.html">Sobre</a></li>
        <li><a href="cadastro.html">Cadastrar</a></li>
        <li class="dropdown">
          <a href="#" id="perfil-link">Perfil</a>
          <ul class="dropdown-content">
            <li><a href="perfil.html">Ver Perfil</a></li>
            <li><a href="#" onclick="logout()">Logout</a></li>
          </ul>
        </li>
      </ul>
    </div>
    </header>

  <div class="adicionarAlbum">
    <div class="alerta_erro">
      <div class="card_erro" id="cardErro">
        <span id="mensagem_erro"></span>
      </div>
    </div>
    <div class="mainContainer">
      <div class="containerAlbum">
        <div class="title">
          <h1>Adicionar álbum</h1>
        </div>
        <div class="row1">
          <div class="nomeBanda">
            <p>Nome do artista/banda</p>
            <input type="text" id="nome_banda" placeholder="The Beatles">
          </div>
          <div class="nomeAlbum">
            <p>Nome do albúm</p>
            <input type="text" id="nome_album" placeholder="Abbey Road">
          </div>
        </div>
        <div class="row2">
          <div class="optionsGen">
            <p>Gênero musical</p>
            <select name="Gênero" id="genero">
              <option value="#">Selecione o gênero</option>
              <option value="Pop">Pop</option>
              <option value="Rock">Rock</option>
              <option value="Hip Hop">Hip Hop</option>
              <option value="Rap">Rap</option>
              <option value="R&B">R&B</option>
              <option value="Soul">Soul</option>
              <option value="Funk">Funk</option>
              <option value="Eletrônica">Eletrônica</option>
              <option value="House">House</option>
              <option value="Techno">Techno</option>
              <option value="Soundtrack">Soundtrack</option>
              <option value="Trap">Trap</option>
              <option value="Reggae">Reggae</option>
              <option value="Ska">Ska</option>
              <option value="Samba">Samba</option>
              <option value="Bossa Nova">Bossa Nova</option>
              <option value="MPB">MPB</option>
              <option value="Forró">Forró</option>
              <option value="Sertanejo">Sertanejo</option>
              <option value="Country">Country</option>
              <option value="Folk">Folk</option>
              <option value="Jazz">Jazz</option>
              <option value="Blues">Blues</option>
              <option value="Gospel">Gospel</option>
              <option value="Clássica">Clássica</option>
              <option value="Lo-fi">Lo-fi</option>
              <option value="K-pop">K-pop</option>
              <option value="J-pop">J-pop</option>
              <option value="Rock Clássico">Rock Clássico</option>
              <option value="Rock Alternativo">Rock Alternativo</option>
              <option value="Hard Rock">Hard Rock</option>
              <option value="Punk Rock">Punk Rock</option>
              <option value="Grunge">Grunge</option>
              <option value="Metal">Metal</option>
              <option value="Heavy Metal">Heavy Metal</option>
              <option value="Thrash Metal">Thrash Metal</option>
              <option value="Death Metal">Death Metal</option>
              <option value="Black Metal">Black Metal</option>
              <option value="Doom Metal">Doom Metal</option>
              <option value="Stoner Rock">Stoner Rock</option>
              <option value="Glam Rock">Glam Rock</option>
              <option value="Glam Metal">Glam Metal</option>
              <option value="Industrial Metal">Industrial Metal</option>
              <option value="Nu Metal">Nu Metal</option>
              <option value="Alternative Metal">Alternative Metal</option>
              <option value="Metalcore">Metalcore</option>
              <option value="Deathcore">Deathcore</option>
              <option value="Sludge Metal">Sludge Metal</option>
              <option value="Folk Metal">Folk Metal</option>
              <option value="Symphonic Metal">Symphonic Metal</option>
              <option value="Progressive Rock">Progressive Rock</option>
              <option value="Progressive Metal">Progressive Metal</option>
              <option value="Post-Rock">Post-Rock</option>
              <option value="Post-Metal">Post-Metal</option>
              <option value="Math Rock">Math Rock</option>
              <option value="Avant-Garde Metal">Avant-Garde Metal</option>
              <option value="Noise Rock">Noise Rock</option>
              <option value="Experimental Rock">Experimental Rock</option>
              <option value="Drone Metal">Drone Metal</option>
              <option value="Jazz Fusion">Jazz Fusion</option>
              <option value="Ambient">Ambient</option>
              <option value="New Age">New Age</option>
              <option value="Chillout">Chillout</option>

            </select>
          </div>
          <div class="lancamento">
            <p>Ano</p>
            <input type="number" id="ano_lancamento" placeholder="1969"
              oninput="this.value = this.value.slice(0, 4);" />
          </div>
        </div>
        <div class="row3">
          <div class="nota">
            <p>Nota: </p>
            <input type="text" id="nota" placeholder="0/10"
              oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 2);" />
          </div>
          <div class="jaEscutei">
            <p>Já escutei:</p>
            <input type="checkbox" id="ja_escutei" style="zoom: 1.5;">
          </div>
        </div>
        <div class="row4">
          <div class="review">
            <p></p>
            <textarea type="text" id="review" placeholder="Adicione sua review..."></textarea>
          </div>
        </div>
        <div class="row5">
          <div class="adcAlbum">
            <p>Adicionar capa do álbum:</p>
          </div>
          <div class="fileadd">
            <input id="capa_album" type="file" />
          </div>
        </div>
        <br>
        <button class="button" onclick="adicionar()">Adicionar</button>
      </div>
    </div>
  </div>
     <div class="perfil-container">
        <h1>Reviews de todos usuários</h1>
        <hr>
        <div id="albuns-container" class="albuns-container">
        </div>
    </div>



  <footer class="footer">
    <div class="footer-content">

      <p>&copy; 2025 review.it — Todos os direitos reservados.</p>
      <ul class="footer-links">
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="musicas.html">Álbums</a></li>
        <li><a href="filmes.html">Filmes</a></li>
        <li><a href="sobremim.html">Sobre</a></li>
        <li><a href="meuperfil.html">Perfil</a></li>
      </ul>
    </div>
  </footer>
</body>

<script>
  if (!sessionStorage.ID_USUARIO) {
    window.location.href = "login.html"; 
}

  listar()
  

 function listar() {
        fetch(`/album/mostrar/`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then((resposta) => {
                if (resposta.ok) {
                    return resposta.json(); 
                } else if (resposta.status === 204) {
                    const container = document.getElementById("albuns-container");
                    container.innerHTML = "<p>Nenhum álbum encontrado!</p>";
                    return [];
                } else {
                    throw new Error("Erro ao buscar álbuns.");
                }
            })
            .then((albuns) => {
                const container = document.getElementById("albuns-container");
                container.innerHTML = ""; 
                albuns.forEach((album) => {
                    const albumCard = document.createElement("div");
                    albumCard.classList.add("album-card");

                    albumCard.innerHTML = `
                    <div class="nome-usuario"> 
                      <img src="assets/${album.imagem_perfil}">
                      <p>${album.nome}</p>
                    </div>
                    <h3><i>${album.nome_banda} - ${album.nome_album}</i></h3>
                        <img src="assets/${album.capa_album}" alt="Capa do álbum" style="width:350px;   height:350px;">
                        <div class="rowws">
                            <div class="roww1">
                                <p><strong>Ano de Lançamento:</strong> ${album.ano_lancamento}</p>
                                <p><strong>Já escutou:</strong> ${album.ja_escutei ? "Sim" : "Não"}</p>
                            </div>
                            <div class="roww2">
                                <p><strong>Gênero:</strong> ${album.genero}</p>
                                <p><strong>Nota:</strong> ${album.nota}/10</p>
                            </div>
                       
                        </div>
                        <div class="roww3"> 
                            <p><strong>Review:</strong> ${album.review}</p>
                            <button onclick="favoritarAlbum(${album.id})">Favoritar</button>
                        </div> 
                                           `;

                    container.appendChild(albumCard);
                });
            })
            .catch((erro) => {
                console.error("Erro ao carregar os álbuns:", erro);
                const container = document.getElementById("albuns-container");
                container.innerHTML = "<p>Erro ao carregar os álbuns.</p>";
            });
}

function favoritarAlbum(idAlbum) {
    const idUsuario = sessionStorage.ID_USUARIO;
    fetch("/favoritar/adicionar", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            idUsuario: idUsuario,
            idAlbum: idAlbum
        })
    })
    .then(res => {
        if (res.ok) {
            alert("Álbum favoritado!");
        } else {
            alert("Erro ao favoritar álbum.");
        }
    })
    .catch(err => {
        console.error("Erro ao favoritar:", err);
        alert("Erro ao favoritar álbum.");
    });
}

function adicionar() {
  var nome_bandaVar = nome_banda.value;
  var nome_albumVar = nome_album.value;
  var generoVar = genero.value;
  var anoLancamento = ano_lancamento.value;
  var notaVar = nota.value;
  var ja_escuteiVar = ja_escutei.checked ? 1 : 0;
  var reviewVar = review.value;
  var capaAlbumFile = capa_album.files[0];

  if (
    nome_bandaVar == "" ||
    nome_albumVar == "" ||
    generoVar == "" ||
    notaVar == "" ||
    reviewVar == "" ||
    !capaAlbumFile
  ) {
    cardErro.style.display = "block";
    mensagem_erro.innerHTML =
      "(Mensagem de erro para todos os campos em branco)";
    return false;
  }

  const formData = new FormData();
  formData.append('nome_banda', nome_bandaVar);
  formData.append('nome_album', nome_albumVar);
  formData.append('ano_lancamento', anoLancamento);
  formData.append('genero', generoVar);
  formData.append('nota', notaVar);
  formData.append('ja_escutei', ja_escuteiVar);
  formData.append('review', reviewVar);
  formData.append('capa_album', capaAlbumFile); 
  formData.append('fk_idUsuario', sessionStorage.ID_USUARIO);

  fetch("/album/adicionar", {
    method: "POST",
    body: formData 
  }).then(function (resposta) {
    if (resposta.ok) {
      cardErro.style.display = "block";
      mensagem_erro.innerHTML =
        "Album adicionado com sucesso! Redirecionando para tela de Perfil...";
      setTimeout(() => {
        window.location = "perfil.html";
      }, 2000);
      limparFormulario();
    } else {
      throw "Houve um erro ao tentar adicionar o album!";
    }
  })
    .catch(function (resposta) {
      console.log(`#ERRO: ${resposta}`);
    });

  return false;
}

</script>